{
  "hash": "085eaaafd95f67d096d03897c2edc467",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"blog post 7\"\nauthor: \"Sean Fung\"\ndate: \"2024-11-26\"\ndate-modified: \"2024-11-26\"\ndraft: FALSE\n---\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\nLinking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE\n\nhere() starts at /Users/seanfung/Documents/BU Fall 2024/MA 415/MA415 G4 Final Project\n\nLoading required package: viridisLite\n\n\nAttaching package: 'MASS'\n\n\nThe following object is masked from 'package:dplyr':\n\n    select\n\n\nTo install your API key for use in future sessions, run this function with `install = TRUE`.\n\nGetting data from the 2016-2020 5-year ACS\n\nDownloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Update visualizations\nggplot(crime_summary_lapd, aes(x = avg_income, y = total_crimes)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  labs(title = \"Crime vs Median Income (LAPD Jurisdiction)\", x = \"Median Income\", y = \"Total Crimes\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](blog-post-7_files/figure-html/Crime Vs Median Income-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = economic_data_lapd, aes(fill = estimate), color = NA) +  # Median income layer\n  scale_fill_viridis_c(option = \"magma\", na.value = \"grey50\") +\n  scale_color_viridis_c(option = \"inferno\", na.value = \"grey50\") +\n  labs(\n    title = \"Median Income within LAPD Jurisdiction\",\n    fill = \"Median Income\",\n    color = \"Average Income\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 18, hjust = 0.5),\n    legend.title = element_text(size = 14),\n    legend.text = element_text(size = 12),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  ) +\n  coord_sf(\n    xlim = c(-119, -117),  # Focus on the Los Angeles area\n    ylim = c(33, 35)       # Focus on the Los Angeles area\n  )\n```\n\n::: {.cell-output-display}\n![](blog-post-7_files/figure-html/Heatmap within LAPD Jurisdiction-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncrime_within_lapd <- st_transform(crime_within_lapd, st_crs(economic_data_lapd))\n\nggplot() +\n  # Median income heatmap\n  geom_sf(data = economic_data_lapd, aes(fill = estimate), color = NA) +  \n  scale_fill_viridis_c(option = \"magma\", na.value = \"grey50\") +\n  scale_color_viridis_c(option = \"inferno\", na.value = \"grey50\") +\n  # Overlay crime points\n  geom_sf(data = crime_within_lapd, aes(), color = \"black\", shape = 4, size = 0.5, alpha = 0.7) +\n  labs(\n    title = \"Median Income and Crime Data within LAPD Jurisdiction\",\n    fill = \"Median Income\",\n    color = \"Average Income\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 18, hjust = 0.5),\n    legend.title = element_text(size = 14),\n    legend.text = element_text(size = 12),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  ) +\n  coord_sf(\n    xlim = c(-119, -117),  # Focus on the Los Angeles area\n    ylim = c(33, 35)       # Focus on the Los Angeles area\n  )\n```\n\n::: {.cell-output-display}\n![](blog-post-7_files/figure-html/Heatmap with Crime Data-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#Good place to use shinylive here. Can filter by year. \n\n# crime_filtered <- crime_within_lapd %>%\n#   filter(year == 2021)\n# ggplot() +\n#   geom_sf(data = economic_data_lapd, aes(fill = estimate), color = NA) +  \n#   scale_fill_viridis_c(option = \"magma\", na.value = \"grey50\") +\n#   geom_sf(data = crime_filtered, aes(), color = \"black\", shape = 4, size = 0.5, alpha = 0.7) +\n#   labs(\n#     title = \"Median Income and 2020 Crime Data within LAPD Jurisdiction\",\n#     fill = \"Median Income\"\n#   ) +\n#   theme_minimal() +\n#   coord_sf(xlim = c(-119, -117), ylim = c(33, 35))\n\n#Look at data utilizing a poisson distribution model. \n# Fit a Poisson regression model\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncrime_summary_race <- crime_with_income %>%\n  group_by(GEOID, Descent_Description) %>%\n  summarize(\n    total_crimes = n(),  # Count crimes for each GEOID and Descent_Description group\n    avg_median_income = mean(estimate, na.rm = TRUE)\n  ) %>%\n  pivot_wider(\n    names_from = Descent_Description,\n    values_from = total_crimes,\n    values_fill = 0  # Fill missing values with 0 for crimes\n  ) %>%\n  rowwise() %>%\n  mutate(\n    total_crimes = sum(c_across(-c(GEOID, avg_median_income, geometry)), na.rm = TRUE)  # Sum only the crime columns\n  ) %>%\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'GEOID'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncrime_summary_race <- crime_summary_race %>%\n  rename_with(~ make.names(.), everything())\n\nbivar_poisson_model <- glm(\n  total_crimes ~ avg_median_income + Hispanic.Latin.Mexican + White + Black + Other + \n    Other.Asian + Unknown + Japanese + Korean + Filipino + Chinese + Hawaiian + \n    Asian.Indian + American.Indian.Alaskan.Native + Cambodian + Vietnamese + Laotian,\n  family = poisson(link = \"log\"),\n  data = crime_summary_race\n)\nsummary(bivar_poisson_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = total_crimes ~ avg_median_income + Hispanic.Latin.Mexican + \n    White + Black + Other + Other.Asian + Unknown + Japanese + \n    Korean + Filipino + Chinese + Hawaiian + Asian.Indian + American.Indian.Alaskan.Native + \n    Cambodian + Vietnamese + Laotian, family = poisson(link = \"log\"), \n    data = crime_summary_race)\n\nCoefficients:\n                                 Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                     5.342e-01  2.044e-02  26.133   <2e-16 ***\navg_median_income              -2.736e-06  2.547e-07 -10.742   <2e-16 ***\nHispanic.Latin.Mexican          1.655e-01  2.937e-03  56.356   <2e-16 ***\nWhite                           2.038e-01  5.124e-03  39.780   <2e-16 ***\nBlack                           1.700e-01  4.936e-03  34.437   <2e-16 ***\nOther                           1.790e-01  1.227e-02  14.593   <2e-16 ***\nOther.Asian                     2.020e-02  4.523e-02   0.447   0.6552    \nUnknown                         1.032e-01  1.612e-03  64.060   <2e-16 ***\nJapanese                       -3.522e-02  1.605e-01  -0.219   0.8263    \nKorean                          8.766e-02  7.250e-02   1.209   0.2266    \nFilipino                       -1.699e-01  1.118e-01  -1.519   0.1287    \nChinese                         1.525e-01  8.545e-02   1.784   0.0744 .  \nHawaiian                       -2.246e-01  3.782e-01  -0.594   0.5525    \nAsian.Indian                   -1.029e-01  3.336e-01  -0.309   0.7577    \nAmerican.Indian.Alaskan.Native -1.647e-01  1.950e-01  -0.845   0.3984    \nCambodian                      -2.265e-02  3.162e-01  -0.072   0.9429    \nVietnamese                     -2.529e-01  1.965e-01  -1.287   0.1980    \nLaotian                        -3.387e-01  1.000e+00  -0.339   0.7348    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 6173.9  on 5564  degrees of freedom\nResidual deviance: 2074.0  on 5547  degrees of freedom\n  (319 observations deleted due to missingness)\nAIC: 15858\n\nNumber of Fisher Scoring iterations: 6\n```\n\n\n:::\n\n```{.r .cell-code}\nbivar_nb_model <- glm.nb(total_crimes ~ avg_median_income + Hispanic.Latin.Mexican + White + Black + Other + \n    Other.Asian + Unknown + Japanese + Korean + Filipino + Chinese + Hawaiian + \n    Asian.Indian + American.Indian.Alaskan.Native + Cambodian + Vietnamese + Laotian, data = crime_summary_race)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in glm.nb(total_crimes ~ avg_median_income + Hispanic.Latin.Mexican + :\nalternation limit reached\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(bivar_nb_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm.nb(formula = total_crimes ~ avg_median_income + Hispanic.Latin.Mexican + \n    White + Black + Other + Other.Asian + Unknown + Japanese + \n    Korean + Filipino + Chinese + Hawaiian + Asian.Indian + American.Indian.Alaskan.Native + \n    Cambodian + Vietnamese + Laotian, data = crime_summary_race, \n    init.theta = 24.74819092, link = log)\n\nCoefficients:\n                                 Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                     2.985e-01  2.278e-02  13.104  < 2e-16 ***\navg_median_income              -1.531e-06  2.654e-07  -5.769 7.95e-09 ***\nHispanic.Latin.Mexican          2.251e-01  4.221e-03  53.326  < 2e-16 ***\nWhite                           2.348e-01  6.021e-03  38.992  < 2e-16 ***\nBlack                           2.165e-01  6.348e-03  34.107  < 2e-16 ***\nOther                           2.142e-01  1.342e-02  15.957  < 2e-16 ***\nOther.Asian                     1.222e-01  4.625e-02   2.641  0.00826 ** \nUnknown                         1.757e-01  2.853e-03  61.570  < 2e-16 ***\nJapanese                        5.779e-02  1.665e-01   0.347  0.72856    \nKorean                          1.780e-01  7.480e-02   2.380  0.01733 *  \nFilipino                       -3.709e-02  1.146e-01  -0.324  0.74630    \nChinese                         1.953e-01  8.929e-02   2.187  0.02874 *  \nHawaiian                       -8.249e-02  3.873e-01  -0.213  0.83136    \nAsian.Indian                    9.135e-03  3.431e-01   0.027  0.97876    \nAmerican.Indian.Alaskan.Native -1.634e-02  1.994e-01  -0.082  0.93470    \nCambodian                       9.126e-02  3.242e-01   0.282  0.77831    \nVietnamese                     -1.173e-01  2.009e-01  -0.584  0.55944    \nLaotian                        -1.891e-01  1.020e+00  -0.185  0.85294    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for Negative Binomial(24.7489) family taken to be 1)\n\n    Null deviance: 5477.7  on 5564  degrees of freedom\nResidual deviance: 1349.0  on 5547  degrees of freedom\n  (319 observations deleted due to missingness)\nAIC: 15580\n\nNumber of Fisher Scoring iterations: 1\n\n              Theta:  24.75 \n          Std. Err.:  1.49 \nWarning while fitting theta: alternation limit reached \n\n 2 x log-likelihood:  -15541.83 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncrime_summary_race_model <- crime_summary_race %>%\n  filter(complete.cases(\n    avg_median_income, Hispanic.Latin.Mexican, White, Black, Other, Other.Asian,\n    Unknown, Japanese, Korean, Filipino, Chinese, Hawaiian, Asian.Indian,\n    American.Indian.Alaskan.Native, Cambodian, Vietnamese, Laotian\n  ))\n\n# Add predicted values to the filtered data\ncrime_summary_race_model <- crime_summary_race_model %>%\n  mutate(predicted_crimes = predict(bivar_nb_model, type = \"response\"))\n\ncrime_race_long <- crime_summary_race_model %>%\n  pivot_longer(\n    cols = c(Hispanic.Latin.Mexican, White, Black, Other, Other.Asian, Unknown, \n             Japanese, Korean, Filipino, Chinese, Hawaiian, Asian.Indian, \n             American.Indian.Alaskan.Native, Cambodian, Vietnamese, Laotian),\n    names_to = \"race\",\n    values_to = \"crime_count\"\n  )\n\n\ncrime_race_long <- crime_summary_race %>%\n  pivot_longer(\n    cols = c(Hispanic.Latin.Mexican, White, Black, Other, Other.Asian, Unknown, \n             Japanese, Korean, Filipino, Chinese, Hawaiian, Asian.Indian, \n             American.Indian.Alaskan.Native, Cambodian, Vietnamese, Laotian),\n    names_to = \"race\",\n    values_to = \"crime_count\"\n  ) %>%\n  filter(!is.na(crime_count) & crime_count > 0) %>%\n  mutate(avg_median_income = avg_median_income / 1000)\n\n\n\n# Fit Poisson regression with pivoted data\npoisson_model <- glm(\n  crime_count ~ avg_median_income + race,\n  family = poisson(link = \"log\"),\n  data = crime_race_long\n)\nsummary(poisson_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = crime_count ~ avg_median_income + race, family = poisson(link = \"log\"), \n    data = crime_race_long)\n\nCoefficients:\n                             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                 0.1632419  0.2298224   0.710 0.477521    \navg_median_income          -0.0019821  0.0002549  -7.777 7.42e-15 ***\nraceAsian.Indian            0.0155105  0.4422303   0.035 0.972021    \nraceBlack                   0.6206238  0.2308355   2.689 0.007175 ** \nraceCambodian               0.1967529  0.5026375   0.391 0.695471    \nraceChinese                 0.1221015  0.2668446   0.458 0.647257    \nraceFilipino               -0.0125247  0.2612828  -0.048 0.961768    \nraceHawaiian               -0.0256375  0.4683073  -0.055 0.956342    \nraceHispanic.Latin.Mexican  0.8102344  0.2300788   3.522 0.000429 ***\nraceJapanese                0.0635533  0.3100358   0.205 0.837582    \nraceKorean                  0.1226668  0.2558546   0.479 0.631626    \nraceLaotian                -0.0216528  1.0259884  -0.021 0.983162    \nraceOther                   0.3349309  0.2320411   1.443 0.148905    \nraceOther.Asian             0.1312525  0.2378787   0.552 0.581111    \nraceUnknown                 0.7716858  0.2301287   3.353 0.000799 ***\nraceVietnamese             -0.0043229  0.3071443  -0.014 0.988771    \nraceWhite                   0.6653885  0.2304941   2.887 0.003892 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 6300.2  on 5907  degrees of freedom\nResidual deviance: 5790.0  on 5891  degrees of freedom\n  (339 observations deleted due to missingness)\nAIC: 20106\n\nNumber of Fisher Scoring iterations: 5\n```\n\n\n:::\n\n```{.r .cell-code}\n# Fit Negative Binomial regression with pivoted data\ncrime_race_long <- crime_race_long %>%\n  filter(complete.cases(avg_median_income, race, crime_count))\n\nnb_model <- glm.nb(\n  crime_count ~ avg_median_income * race,\n  data = crime_race_long\n)\nsummary(nb_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm.nb(formula = crime_count ~ avg_median_income * race, data = crime_race_long, \n    init.theta = 9.252493725, link = log)\n\nCoefficients: (1 not defined because of singularities)\n                                               Estimate Std. Error z value\n(Intercept)                                   0.1455120  0.4202718   0.346\navg_median_income                            -0.0016531  0.0063198  -0.262\nraceAsian.Indian                             -0.1455120  1.0570790  -0.138\nraceBlack                                     0.7861658  0.4246697   1.851\nraceCambodian                                 0.4754042  1.0460402   0.454\nraceChinese                                  -0.1475022  0.5367116  -0.275\nraceFilipino                                 -0.1663137  0.5407560  -0.308\nraceHawaiian                                 -0.1455120  1.0060103  -0.145\nraceHispanic.Latin.Mexican                    1.0450224  0.4226039   2.473\nraceJapanese                                  0.1871495  0.6428169   0.291\nraceKorean                                    0.1289437  0.4757716   0.271\nraceLaotian                                  -0.0274248  1.0855404  -0.025\nraceOther                                     0.2422653  0.4272637   0.567\nraceOther.Asian                               0.0666385  0.4443021   0.150\nraceUnknown                                   0.7903132  0.4223953   1.871\nraceVietnamese                               -0.1455120  0.6123748  -0.238\nraceWhite                                     0.4589181  0.4231629   1.084\navg_median_income:raceAsian.Indian            0.0016531  0.0115164   0.144\navg_median_income:raceBlack                  -0.0027989  0.0063851  -0.438\navg_median_income:raceCambodian              -0.0043472  0.0145757  -0.298\navg_median_income:raceChinese                 0.0030248  0.0071816   0.421\navg_median_income:raceFilipino                0.0021817  0.0077737   0.281\navg_median_income:raceHawaiian                0.0016531  0.0130268   0.127\navg_median_income:raceHispanic.Latin.Mexican -0.0038425  0.0063534  -0.605\navg_median_income:raceJapanese               -0.0019210  0.0091102  -0.211\navg_median_income:raceKorean                 -0.0001553  0.0069246  -0.022\navg_median_income:raceLaotian                        NA         NA      NA\navg_median_income:raceOther                   0.0011020  0.0063781   0.173\navg_median_income:raceOther.Asian             0.0008324  0.0065657   0.127\navg_median_income:raceUnknown                -0.0003425  0.0063433  -0.054\navg_median_income:raceVietnamese              0.0016531  0.0079050   0.209\navg_median_income:raceWhite                   0.0023250  0.0063396   0.367\n                                             Pr(>|z|)  \n(Intercept)                                    0.7292  \navg_median_income                              0.7937  \nraceAsian.Indian                               0.8905  \nraceBlack                                      0.0641 .\nraceCambodian                                  0.6495  \nraceChinese                                    0.7835  \nraceFilipino                                   0.7584  \nraceHawaiian                                   0.8850  \nraceHispanic.Latin.Mexican                     0.0134 *\nraceJapanese                                   0.7709  \nraceKorean                                     0.7864  \nraceLaotian                                    0.9798  \nraceOther                                      0.5707  \nraceOther.Asian                                0.8808  \nraceUnknown                                    0.0613 .\nraceVietnamese                                 0.8122  \nraceWhite                                      0.2781  \navg_median_income:raceAsian.Indian             0.8859  \navg_median_income:raceBlack                    0.6611  \navg_median_income:raceCambodian                0.7655  \navg_median_income:raceChinese                  0.6736  \navg_median_income:raceFilipino                 0.7790  \navg_median_income:raceHawaiian                 0.8990  \navg_median_income:raceHispanic.Latin.Mexican   0.5453  \navg_median_income:raceJapanese                 0.8330  \navg_median_income:raceKorean                   0.9821  \navg_median_income:raceLaotian                      NA  \navg_median_income:raceOther                    0.8628  \navg_median_income:raceOther.Asian              0.8991  \navg_median_income:raceUnknown                  0.9569  \navg_median_income:raceVietnamese               0.8344  \navg_median_income:raceWhite                    0.7138  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for Negative Binomial(9.2525) family taken to be 1)\n\n    Null deviance: 4800.1  on 5907  degrees of freedom\nResidual deviance: 4305.8  on 5877  degrees of freedom\nAIC: 19758\n\nNumber of Fisher Scoring iterations: 1\n\n              Theta:  9.252 \n          Std. Err.:  0.706 \n\n 2 x log-likelihood:  -19694.184 \n```\n\n\n:::\n\n```{.r .cell-code}\ncrime_race_long <- crime_race_long %>%\n  mutate(predicted_crimes = predict(nb_model, newdata = crime_race_long, type = \"response\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(crime_race_long)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GEOID\"             \"avg_median_income\" \"geometry\"         \n[4] \"total_crimes\"      \"race\"              \"crime_count\"      \n[7] \"predicted_crimes\" \n```\n\n\n:::\n\n```{.r .cell-code}\ngrid <- expand.grid(\n  avg_median_income = seq(min(crime_race_long$avg_median_income), max(crime_race_long$avg_median_income), length.out = 100),\n  race = unique(crime_race_long$race)\n)\n\ngrid$predicted_crimes <- predict(nb_model, newdata = grid, type = \"response\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in predict.lm(object, newdata, se.fit, scale = 1, type = if (type == :\nprediction from rank-deficient fit; attr(*, \"non-estim\") has doubtful cases\n```\n\n\n:::\n\n```{.r .cell-code}\nggplot(grid, aes(x = avg_median_income, y = predicted_crimes, color = race)) +\n  geom_line() +\n  labs(\n    title = \"Predicted Crime Counts vs Median Income by Race\",\n    x = \"Average Median Income (in $1,000s)\",\n    y = \"Predicted Crime Counts\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](blog-post-7_files/figure-html/Refinement of model-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(grid, aes(x = avg_median_income, y = predicted_crimes, color = race)) +\n  geom_line() +\n  facet_wrap(~race, scales = \"free_y\") +  # Facet by race, allowing y-axis to vary by panel\n  labs(\n    title = \"Predicted Crime Counts vs Median Income by Race (Facet by Race)\",\n    x = \"Average Median Income (in $1,000s)\",\n    y = \"Predicted Crime Counts\"\n  ) +\n  theme_minimal() +\n  theme(\n    strip.text = element_text(size = 10),  # Adjust facet labels\n    legend.position = \"none\"              # Hide legend if redundant\n  )\n```\n\n::: {.cell-output-display}\n![](blog-post-7_files/figure-html/Refinement of model-2.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncrime_summary_blocks <- crime_within_lapd %>%\n  group_by(AREA.NAME) %>%\n  summarize(\n    total_crimes = n(),\n    geometry = st_union(geometry)  # Combine geometries for each group\n  ) %>%\n  filter(!is.na(total_crimes)) %>%  # Exclude areas with no crimes\n  st_as_sf()  # Ensure it remains an sf object\n\nprint(crime_summary_blocks)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 21 features and 2 fields\nGeometry type: MULTIPOINT\nDimension:     XY\nBounding box:  xmin: -118.6676 ymin: 33.7087 xmax: -118.1585 ymax: 34.3272\nGeodetic CRS:  WGS 84\n# A tibble: 21 × 3\n   AREA.NAME   total_crimes                                             geometry\n * <chr>              <int>                                     <MULTIPOINT [°]>\n 1 77th Street          823 ((-118.3113 33.94), (-118.3123 33.9418), (-118.3113…\n 2 Central              891 ((-118.2292 34.0365), (-118.2294 34.0385), (-118.23…\n 3 Devonshire           546 ((-118.5981 34.2713), (-118.5916 34.2691), (-118.58…\n 4 Foothill             431 ((-118.4389 34.2644), (-118.4385 34.2621), (-118.43…\n 5 Harbor               532 ((-118.3041 33.8481), (-118.3035 33.855), (-118.303…\n 6 Hollenbeck           428 ((-118.1861 34.1077), (-118.1987 34.0915), (-118.20…\n 7 Hollywood            636 ((-118.304 34.0835), (-118.3028 34.0836), (-118.300…\n 8 Mission              511 ((-118.4926 34.3197), (-118.4958 34.3216), (-118.40…\n 9 N Hollywood          662 ((-118.3878 34.2067), (-118.3891 34.2067), (-118.39…\n10 Newton               584 ((-118.23 34.0326), (-118.2322 34.0306), (-118.2323…\n# ℹ 11 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\ncrime_summary_blocks <- st_set_crs(crime_summary_blocks, 4326)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load LAPD boundary\nlapd_boundary <- st_read(here(\"CityBoundaryofLosAngeles/geo_export_416eaeda-447a-4473-b003-37e2cad181ac.shp\")) %>%\n  st_make_valid() %>%                # Ensure valid geometry\n  st_transform(crs = 4326)           # Align CRS (use WGS84 as default)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `geo_export_416eaeda-447a-4473-b003-37e2cad181ac' from data source `/Users/seanfung/Documents/BU Fall 2024/MA 415/MA415 G4 Final Project/CityBoundaryofLosAngeles/geo_export_416eaeda-447a-4473-b003-37e2cad181ac.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1 feature and 2 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -118.6682 ymin: 33.70365 xmax: -118.1554 ymax: 34.33731\nGeodetic CRS:  WGS84(DD)\n```\n\n\n:::\n\n```{.r .cell-code}\n# Load neighborhoods\nneighborhoods <- st_read(here(\"LA_Times_Neighborhood_Boundaries-shp/8494cd42-db48-4af1-a215-a2c8f61e96a22020328-1-621do0.x5yiu.shp\")) %>%\n  st_make_valid() %>%\n  st_transform(crs = st_crs(lapd_boundary))  # Match CRS with LAPD boundary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `8494cd42-db48-4af1-a215-a2c8f61e96a22020328-1-621do0.x5yiu' from data source `/Users/seanfung/Documents/BU Fall 2024/MA 415/MA415 G4 Final Project/LA_Times_Neighborhood_Boundaries-shp/8494cd42-db48-4af1-a215-a2c8f61e96a22020328-1-621do0.x5yiu.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 114 features and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 6359592 ymin: 1715035 xmax: 6514633 ymax: 1945515\nProjected CRS: NAD83 / California zone 5 (ftUS)\n```\n\n\n:::\n\n```{.r .cell-code}\nneighborhoods_lapd <- st_intersection(neighborhoods, lapd_boundary)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n\n```{.r .cell-code}\nneighborhoods_lapd <- st_buffer(neighborhoods, dist = 0) %>%\n  st_intersection(st_buffer(lapd_boundary, dist = 0))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: attribute variables are assumed to be spatially constant throughout\nall geometries\n```\n\n\n:::\n\n```{.r .cell-code}\ncrime_sf <- st_as_sf(data, coords = c(\"LON\", \"LAT\"), crs = 4326)  # Crime data as sf object\n\n# Filter crimes to those within LAPD boundary\ncrimes_in_lapd <- st_filter(crime_sf, lapd_boundary)\n\nneighborhoods_lapd <- st_make_valid(neighborhoods_lapd)\ncrimes_in_lapd <- st_make_valid(crimes_in_lapd)\n\n# Join crimes to neighborhoods\ncrimes_by_neighborhood <- st_join(crimes_in_lapd, neighborhoods_lapd, join = st_within)\n\n\n# Ensure crimes_by_neighborhood includes counts and neighborhood polygons\ncrime_summary <- neighborhoods_lapd %>%\n  left_join(\n    crimes_by_neighborhood %>%\n      st_drop_geometry() %>%  # Drop point geometry to focus on attributes\n      group_by(name) %>%      # Replace \"NAME\" with neighborhood column in neighborhoods_lapd\n      summarize(total_crimes = n()),\n    by = \"name\"               # Join by neighborhood name or another matching column\n  )\n\n\n\nggplot() +\n  geom_sf(data = neighborhoods_lapd, fill = NA, color = \"black\") +  # Neighborhood outlines\n  geom_sf(data = crime_summary, aes(fill = total_crimes), color = NA) +\n  scale_fill_viridis_c(option = \"plasma\", na.value = \"grey50\") +\n  labs(\n    title = \"Heatmap of Crimes by Neighborhood (LAPD Jurisdiction)\",\n    fill = \"Total Crimes\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    plot.title = element_text(size = 18, hjust = 0.5),\n    legend.title = element_text(size = 14),\n    legend.text = element_text(size = 12)\n  )\n```\n\n::: {.cell-output-display}\n![](blog-post-7_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "blog-post-7_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}